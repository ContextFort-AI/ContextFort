/*! For license information please see content.js.LICENSE.txt */
(()=>{function e(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return n(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,l=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return c=e.done,e},e:function(e){l=!0,a=e},f:function(){try{c||null==o.return||o.return()}finally{if(l)throw a}}}}function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=Array(n);t<n;t++)o[t]=e[t];return o}function t(){var e,n,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function c(t,r,i,a){var c=r&&r.prototype instanceof s?r:s,d=Object.create(c.prototype);return o(d,"_invoke",function(t,o,r){var i,a,c,s=0,d=r||[],u=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(n,t){return i=n,a=0,c=e,f.n=t,l}};function p(t,o){for(a=t,c=o,n=0;!u&&s&&!r&&n<d.length;n++){var r,i=d[n],p=f.p,m=i[2];t>3?(r=m===o)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=p&&((r=t<2&&p<i[1])?(a=0,f.v=o,f.n=i[1]):p<m&&(r=t<3||i[0]>o||o>m)&&(i[4]=t,i[5]=o,f.n=m,a=0))}if(r||t>1)return l;throw u=!0,o}return function(r,d,m){if(s>1)throw TypeError("Generator is already running");for(u&&1===d&&p(d,m),a=d,c=m;(n=a<2?e:c)||!u;){i||(a?a<3?(a>1&&(f.n=-1),p(a,c)):f.n=c:f.v=c);try{if(s=2,i){if(a||(r="next"),n=i[r]){if(!(n=n.call(i,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);i=e}else if((n=(u=f.n<0)?c:t.call(o,f))!==l)break}catch(n){i=e,a=1,c=n}finally{s=1}}return{value:n,done:u}}}(t,i,a),!0),d}var l={};function s(){}function d(){}function u(){}n=Object.getPrototypeOf;var f=[][i]?n(n([][i]())):(o(n={},i,function(){return this}),n),p=u.prototype=s.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,o(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return d.prototype=u,o(p,"constructor",u),o(u,"constructor",d),d.displayName="GeneratorFunction",o(u,a,"GeneratorFunction"),o(p),o(p,a,"Generator"),o(p,i,function(){return this}),o(p,"toString",function(){return"[object Generator]"}),(t=function(){return{w:c,m}})()}function o(e,n,t,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}o=function(e,n,t,r){function a(n,t){o(e,n,function(e){return this._invoke(n,t,e)})}n?i?i(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(a("next",0),a("throw",1),a("return",2))},o(e,n,t,r)}function r(e,n,t,o,r,i,a){try{var c=e[i](a),l=c.value}catch(e){return void t(e)}c.done?n(l):Promise.resolve(l).then(o,r)}var i=!1;function a(e){try{var n;"undefined"!=typeof chrome&&null!==(n=chrome)&&void 0!==n&&null!==(n=n.runtime)&&void 0!==n&&n.sendMessage?chrome.runtime.sendMessage(e):console.error("[ContextFort] chrome.runtime.sendMessage is not available")}catch(e){console.error("[ContextFort] Error sending message to background script:",e)}}function c(e){var n;if(!e)return null;var t=null;return e.className&&("string"==typeof e.className?t=e.className:void 0!==e.className.baseVal&&(t=e.className.baseVal)),{tag:e.tagName,id:e.id||null,className:t,text:(null===(n=e.textContent)||void 0===n?void 0:n.substring(0,50))||null,type:e.type||null,name:e.name||null}}function l(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=document.getElementById("contextfort-login-notification");t&&t.remove();var o=document.getElementById("contextfort-login-minimized");o&&o.remove();var r=document.createElement("div");r.id="contextfort-login-notification",r.style.cssText='\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    min-width: 360px;\n    max-width: 420px;\n    background: #1a1a1a;\n    border-radius: 12px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\n    z-index: 2147483647;\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n    padding: 20px;\n    animation: contextfort-slide-in 0.3s ease-out;\n    border: 1px solid #333;\n    transition: transform 0.3s ease;\n  ';var i=document.createElement("div");if(i.id="contextfort-login-minimized",i.style.cssText="\n    position: fixed;\n    bottom: 20px;\n    right: 0;\n    background: #1a1a1a;\n    border-radius: 8px 0 0 8px;\n    padding: 12px 16px;\n    cursor: pointer;\n    z-index: 2147483647;\n    font-family: -apple-system, BlinkMacSystemFont, sans-serif;\n    display: none;\n    align-items: center;\n    gap: 8px;\n    border: 1px solid #333;\n    border-right: none;\n    box-shadow: -4px 0 16px rgba(0, 0, 0, 0.3);\n  ",i.innerHTML='<span style="font-size: 18px;">üîê</span><span style="color: #fff; font-size: 12px; font-weight: 600;">Login</span>',i.onclick=function(){i.style.display="none",r.style.display="block",r.style.animation="contextfort-slide-in 0.3s ease-out"},!document.getElementById("contextfort-notification-styles")){var c=document.createElement("style");c.id="contextfort-notification-styles",c.textContent="\n      @keyframes contextfort-slide-in {\n        from { transform: translateX(420px); opacity: 0; }\n        to { transform: translateX(0); opacity: 1; }\n      }\n      @keyframes contextfort-slide-out {\n        from { transform: translateX(0); opacity: 1; }\n        to { transform: translateX(420px); opacity: 0; }\n      }\n    ",document.head.appendChild(c)}var s=document.createElement("div");s.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 12px;\n  ";var d=document.createElement("div");d.style.cssText="display: flex; align-items: center; gap: 10px;",d.innerHTML='\n    <span style="font-size: 24px;">üîê</span>\n    <span style="font-size: 16px; font-weight: 600; color: #fff;">Manual Login Required</span>\n  ';var u=document.createElement("button");u.innerHTML="‚àí",u.style.cssText="\n    background: #333;\n    border: none;\n    color: #fff;\n    width: 24px;\n    height: 24px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 18px;\n    line-height: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  ",u.onclick=function(){r.style.display="none",i.style.display="flex"},s.appendChild(d),s.appendChild(u),document.body.appendChild(i);var f=document.createElement("div");f.style.cssText="\n    font-size: 14px;\n    color: #aaa;\n    line-height: 1.5;\n    margin-bottom: 16px;\n  ";var p=document.createElement("div");if(p.style.cssText="\n    display: flex;\n    gap: 10px;\n  ",1===n){f.innerHTML='\n      No saved agent session for <strong style="color: #fff;">'.concat(e,"</strong><br><br>\n      Your session has been cleared. You need to login manually for the agent to use this site.\n    ");var m=document.createElement("button");m.textContent="Ok, I'll log in",m.style.cssText="\n      flex: 1;\n      padding: 12px 16px;\n      background: #4ADE80;\n      color: #000;\n      border: none;\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: background 0.2s;\n    ",m.onmouseover=function(){return m.style.background="#3bc56f"},m.onmouseout=function(){return m.style.background="#4ADE80"},m.onclick=function(){a({type:"OK_LOGIN_CLICKED",domain:e}),l(e,2)},p.appendChild(m)}else{f.innerHTML='\n      No saved agent session for <strong style="color: #fff;">'.concat(e,'</strong><br><br>\n      Please login, then click "I\'ve Logged In".<br><br>\n      Or click "Restore My Session" to get your cookies back.\n    ');var y=document.createElement("button");y.textContent="I've Logged In",y.style.cssText="\n      flex: 1;\n      padding: 12px 16px;\n      background: #4ADE80;\n      color: #000;\n      border: none;\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: background 0.2s;\n    ",y.onmouseover=function(){return y.style.background="#3bc56f"},y.onmouseout=function(){return y.style.background="#4ADE80"},y.onclick=function(){a({type:"LOGIN_BUTTON_CLICKED",domain:e}),r.style.animation="contextfort-slide-out 0.3s ease-out",setTimeout(function(){r.remove(),i.remove()},300)};var x=document.createElement("button");x.textContent="Restore My Session",x.style.cssText="\n      flex: 1;\n      padding: 12px 16px;\n      background: #333;\n      color: #fff;\n      border: 1px solid #555;\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: background 0.2s;\n    ",x.onmouseover=function(){return x.style.background="#444"},x.onmouseout=function(){return x.style.background="#333"},x.onclick=function(){a({type:"RESTORE_BUTTON_CLICKED",domain:e}),r.style.animation="contextfort-slide-out 0.3s ease-out",setTimeout(function(){r.remove(),i.remove()},300)},p.appendChild(y),p.appendChild(x)}r.appendChild(s),r.appendChild(f),r.appendChild(p),document.body.appendChild(r)}function s(e){i&&a({type:"SCREENSHOT_TRIGGER",action:"click",eventType:"click",element:c(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title})}function d(e){i&&a({type:"SCREENSHOT_TRIGGER",action:"dblclick",eventType:"click",element:c(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title})}function u(e){i&&a({type:"SCREENSHOT_TRIGGER",action:"rightclick",eventType:"click",element:c(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title})}function f(e){i&&a({type:"SCREENSHOT_TRIGGER",action:e.type,eventType:"input",element:c(e.target),inputValue:e.target.value||null,url:window.location.href,title:document.title})}var p,m=[];function y(e,n){var t,o=e.tagName,r=e.id||null,i=e.className||null,a=(null===(t=e.textContent)||void 0===t?void 0:t.trim())||null,c=e.type||null,l=e.name||null;return n.elementTag===o&&n.elementId===r&&n.elementClass===i&&(null===n.elementText||n.elementText===a)&&n.elementType===c&&n.elementName===l}function x(e){var n=e.style.border;e.style.border="2px solid red",setTimeout(function(){e.style.border=n},500)}function v(n){if(function(n){for(var t=window.location.href,o=document.title,r=n;r&&r!==document.body;){var i,a=e(m);try{for(a.s();!(i=a.n()).done;){var c=i.value;if("click"===c.actionType&&(!c.url||c.url===t)&&(!c.title||c.title===o)&&y(r,c))return!0}}catch(e){a.e(e)}finally{a.f()}r=r.parentElement}return!1}(n.target))return n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),x(n.target),a({type:"ACTION_BLOCKED",actionType:"click",url:window.location.href,title:document.title}),!1}function g(n){if(function(n){for(var t=window.location.href,o=document.title,r=n;r&&r!==document.body;){var i,a=e(m);try{for(a.s();!(i=a.n()).done;){var c=i.value;if(("input"===c.actionType||"change"===c.actionType)&&(!c.url||c.url===t)&&(!c.title||c.title===o)&&y(r,c))return!0}}catch(e){a.e(e)}finally{a.f()}r=r.parentElement}return!1}(n.target))return n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),x(n.target),a({type:"ACTION_BLOCKED",actionType:"input",url:window.location.href,title:document.title}),!1}(p=t().m(function e(){var n;return t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,chrome.storage.local.get(["blockedActions"]);case 1:(n=e.v).blockedActions&&(m=n.blockedActions);case 2:return e.a(2)}},e)}),function(){var e=this,n=arguments;return new Promise(function(t,o){var i=p.apply(e,n);function a(e){r(i,t,o,a,c,"next",e)}function c(e){r(i,t,o,a,c,"throw",e)}a(void 0)})})(),chrome.storage.onChanged.addListener(function(e,n){"local"===n&&e.blockedActions&&(m=e.blockedActions.newValue||[])}),chrome.runtime.onMessage.addListener(function(e,n,t){if("SHOW_NOTIFICATION"===e.type)!function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error",o=document.getElementById("contextfort-notification");o&&o.remove();var r=document.createElement("div");if(r.id="contextfort-notification",r.style.cssText='\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    min-width: 320px;\n    max-width: 400px;\n    background: white;\n    border-radius: 8px;\n    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2), 0 2px 8px rgba(0, 0, 0, 0.1);\n    z-index: 2147483647;\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n    display: flex;\n    align-items: flex-start;\n    padding: 16px;\n    gap: 12px;\n    animation: contextfort-slide-in 0.3s ease-out;\n    border-left: 4px solid '.concat("error"===t?"#DC2626":"#2563EB",";\n  "),!document.getElementById("contextfort-notification-styles")){var i=document.createElement("style");i.id="contextfort-notification-styles",i.textContent="\n      @keyframes contextfort-slide-in {\n        from {\n          transform: translateX(420px);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n      @keyframes contextfort-slide-out {\n        from {\n          transform: translateX(0);\n          opacity: 1;\n        }\n        to {\n          transform: translateX(420px);\n          opacity: 0;\n        }\n      }\n    ",document.head.appendChild(i)}var a=document.createElement("div");a.style.cssText="\n    flex-shrink: 0;\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    line-height: 24px;\n  ",a.textContent="error"===t?"‚õî":"‚ÑπÔ∏è";var c=document.createElement("div");c.style.cssText="\n    flex: 1;\n    min-width: 0;\n  ";var l=document.createElement("div");l.style.cssText="\n    font-weight: 600;\n    font-size: 14px;\n    color: #1F2937;\n    margin-bottom: 4px;\n  ",l.textContent=e;var s=document.createElement("div");s.style.cssText="\n    font-size: 13px;\n    color: #6B7280;\n    line-height: 1.4;\n  ",s.textContent=n,c.appendChild(l),c.appendChild(s);var d=document.createElement("button");d.style.cssText="\n    flex-shrink: 0;\n    width: 20px;\n    height: 20px;\n    border: none;\n    background: transparent;\n    color: #9CA3AF;\n    cursor: pointer;\n    font-size: 18px;\n    line-height: 1;\n    padding: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  ",d.textContent="√ó",d.onclick=function(){r.style.animation="contextfort-slide-out 0.3s ease-out",setTimeout(function(){return r.remove()},300)},r.appendChild(a),r.appendChild(c),r.appendChild(d),document.body.appendChild(r),setTimeout(function(){r.parentElement&&(r.style.animation="contextfort-slide-out 0.3s ease-out",setTimeout(function(){return r.remove()},300))},5e3)}(e.title,e.message,e.notificationType);else{if("SHOW_LOGIN_NOTIFICATION"===e.type)return l(e.domain,e.phase||1),t({success:!0}),!0;if("START_AGENT_LISTENING"===e.type)return i||(i=!0,document.addEventListener("click",v,!0),document.addEventListener("input",g,!0),document.addEventListener("click",s,!0),document.addEventListener("dblclick",d,!0),document.addEventListener("contextmenu",u,!0),document.addEventListener("input",f,!0)),t({success:!0}),!0;if("STOP_AGENT_LISTENING"===e.type)return i&&(i=!1,document.removeEventListener("input",f,!0),document.removeEventListener("contextmenu",u,!0),document.removeEventListener("dblclick",d,!0),document.removeEventListener("click",s,!0),document.removeEventListener("input",g,!0),document.removeEventListener("click",v,!0)),t({success:!0}),!0}})})();