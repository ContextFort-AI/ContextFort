/*! For license information please see content.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=i.call(n)).done)&&(s.push(o.value),s.length!==t);c=!0);}catch(e){l=!0,r=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach(function(t){r(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function r(t,n,o){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t}function i(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function a(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function c(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,o,r,i){var c=o&&o.prototype instanceof s?o:s,u=Object.create(c.prototype);return l(u,"_invoke",function(n,o,r){var i,s,c,l=0,u=r||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,a}};function p(n,o){for(s=n,c=o,t=0;!d&&l&&!r&&t<u.length;t++){var r,i=u[t],p=f.p,m=i[2];n>3?(r=m===o)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((r=n<2&&p<i[1])?(s=0,f.v=o,f.n=i[1]):p<m&&(r=n<3||i[0]>o||o>m)&&(i[4]=n,i[5]=o,f.n=m,s=0))}if(r||n>1)return a;throw d=!0,o}return function(r,u,m){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&p(u,m),s=u,c=m;(t=s<2?e:c)||!d;){i||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(l=2,i){if(s||(r="next"),t=i[r]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),s=1);i=e}else if((t=(d=f.n<0)?c:n.call(o,f))!==a)break}catch(t){i=e,s=1,c=t}finally{l=1}}return{value:t,done:d}}}(n,r,i),!0),u}var a={};function s(){}function u(){}function d(){}t=Object.getPrototypeOf;var f=[][o]?t(t([][o]())):(l(t={},o,function(){return this}),t),p=d.prototype=s.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,l(e,r,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=d,l(p,"constructor",d),l(d,"constructor",u),u.displayName="GeneratorFunction",l(d,r,"GeneratorFunction"),l(p),l(p,r,"Generator"),l(p,o,function(){return this}),l(p,"toString",function(){return"[object Generator]"}),(c=function(){return{w:i,m}})()}function l(e,t,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}l=function(e,t,n,o){function i(t,n){l(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},l(e,t,n,o)}function u(e,t,n,o,r,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(o,r)}var d=!1;function f(e){try{var t;"undefined"!=typeof chrome&&null!==(t=chrome)&&void 0!==t&&null!==(t=t.runtime)&&void 0!==t&&t.sendMessage?chrome.runtime.sendMessage(e):console.error("[ContextFort] chrome.runtime.sendMessage is not available")}catch(e){console.error("[ContextFort] Error sending message to background script:",e)}}function p(e){var t;if(!e)return null;var n=null;return e.className&&("string"==typeof e.className?n=e.className:void 0!==e.className.baseVal&&(n=e.className.baseVal)),{tag:e.tagName,id:e.id||null,className:n,text:(null===(t=e.textContent)||void 0===t?void 0:t.substring(0,50))||null,type:e.type||null,name:e.name||null}}function m(e){d&&f({type:"SCREENSHOT_TRIGGER",action:"click",eventType:"click",element:p(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title})}function y(e){d&&f({type:"SCREENSHOT_TRIGGER",action:"dblclick",eventType:"click",element:p(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title})}function g(e){d&&f({type:"SCREENSHOT_TRIGGER",action:"rightclick",eventType:"click",element:p(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title})}function v(e){d&&f({type:"SCREENSHOT_TRIGGER",action:e.type,eventType:"input",element:p(e.target),inputValue:e.target.value||null,url:window.location.href,title:document.title})}var S,b=[];function x(e,t){var n,o=e.tagName,r=e.id||null,i=e.className||null,a=(null===(n=e.textContent)||void 0===n?void 0:n.trim())||null,s=e.type||null,c=e.name||null;return t.elementTag===o&&t.elementId===r&&t.elementClass===i&&(null===t.elementText||t.elementText===a)&&t.elementType===s&&t.elementName===c}function E(e){var t=e.style.border;e.style.border="2px solid red",setTimeout(function(){e.style.border=t},500)}function h(e){if(function(e){for(var t=window.location.href,n=document.title,o=e;o&&o!==document.body;){var r,a=i(b);try{for(a.s();!(r=a.n()).done;){var s=r.value;if("click"===s.actionType&&(!s.url||s.url===t)&&(!s.title||s.title===n)&&x(o,s))return!0}}catch(e){a.e(e)}finally{a.f()}o=o.parentElement}return!1}(e.target))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),E(e.target),f({type:"ACTION_BLOCKED",actionType:"click",url:window.location.href,title:document.title}),!1}function T(e){if(function(e){for(var t=window.location.href,n=document.title,o=e;o&&o!==document.body;){var r,a=i(b);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(("input"===s.actionType||"change"===s.actionType)&&(!s.url||s.url===t)&&(!s.title||s.title===n)&&x(o,s))return!0}}catch(e){a.e(e)}finally{a.f()}o=o.parentElement}return!1}(e.target))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),E(e.target),f({type:"ACTION_BLOCKED",actionType:"input",url:window.location.href,title:document.title}),!1}(S=c().m(function e(){var t;return c().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,chrome.storage.local.get(["blockedActions"]);case 1:(t=e.v).blockedActions&&(b=t.blockedActions);case 2:return e.a(2)}},e)}),function(){var e=this,t=arguments;return new Promise(function(n,o){var r=S.apply(e,t);function i(e){u(r,n,o,i,a,"next",e)}function a(e){u(r,n,o,i,a,"throw",e)}i(void 0)})})(),chrome.storage.onChanged.addListener(function(e,t){"local"===t&&e.blockedActions&&(b=e.blockedActions.newValue||[])}),chrome.runtime.onMessage.addListener(function(e,n,r){if("SHOW_NOTIFICATION"===e.type)!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error",o=document.getElementById("contextfort-notification");o&&o.remove();var r=document.createElement("div");if(r.id="contextfort-notification",r.style.cssText='\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    min-width: 320px;\n    max-width: 400px;\n    background: white;\n    border-radius: 8px;\n    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2), 0 2px 8px rgba(0, 0, 0, 0.1);\n    z-index: 2147483647;\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n    display: flex;\n    align-items: flex-start;\n    padding: 16px;\n    gap: 12px;\n    animation: contextfort-slide-in 0.3s ease-out;\n    border-left: 4px solid '.concat("error"===n?"#DC2626":"#2563EB",";\n  "),!document.getElementById("contextfort-notification-styles")){var i=document.createElement("style");i.id="contextfort-notification-styles",i.textContent="\n      @keyframes contextfort-slide-in {\n        from {\n          transform: translateX(420px);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n      @keyframes contextfort-slide-out {\n        from {\n          transform: translateX(0);\n          opacity: 1;\n        }\n        to {\n          transform: translateX(420px);\n          opacity: 0;\n        }\n      }\n    ",document.head.appendChild(i)}var a=document.createElement("div");a.style.cssText="\n    flex-shrink: 0;\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    line-height: 24px;\n  ",a.textContent="error"===n?"‚õî":"‚ÑπÔ∏è";var s=document.createElement("div");s.style.cssText="\n    flex: 1;\n    min-width: 0;\n  ";var c=document.createElement("div");c.style.cssText="\n    font-weight: 600;\n    font-size: 14px;\n    color: #1F2937;\n    margin-bottom: 4px;\n  ",c.textContent=e;var l=document.createElement("div");l.style.cssText="\n    font-size: 13px;\n    color: #6B7280;\n    line-height: 1.4;\n  ",l.textContent=t,s.appendChild(c),s.appendChild(l);var u=document.createElement("button");u.style.cssText="\n    flex-shrink: 0;\n    width: 20px;\n    height: 20px;\n    border: none;\n    background: transparent;\n    color: #9CA3AF;\n    cursor: pointer;\n    font-size: 18px;\n    line-height: 1;\n    padding: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  ",u.textContent="√ó",u.onclick=function(){r.style.animation="contextfort-slide-out 0.3s ease-out",setTimeout(function(){return r.remove()},300)},r.appendChild(a),r.appendChild(s),r.appendChild(u),document.body.appendChild(r),setTimeout(function(){r.parentElement&&(r.style.animation="contextfort-slide-out 0.3s ease-out",setTimeout(function(){return r.remove()},300))},5e3)}(e.title,e.message,e.notificationType);else{if("SHOW_LOGIN_NOTIFICATION"===e.type)return console.log("[SessionIsolation] SHOW_LOGIN_NOTIFICATION received for domain:",e.domain),function(e){var t=document.getElementById("contextfort-login-notification");t&&t.remove();var n=document.createElement("div");if(n.id="contextfort-login-notification",n.style.cssText='\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    min-width: 360px;\n    max-width: 420px;\n    background: #1a1a1a;\n    border-radius: 12px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\n    z-index: 2147483647;\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n    padding: 20px;\n    animation: contextfort-slide-in 0.3s ease-out;\n    border: 1px solid #333;\n  ',!document.getElementById("contextfort-notification-styles")){var o=document.createElement("style");o.id="contextfort-notification-styles",o.textContent="\n      @keyframes contextfort-slide-in {\n        from { transform: translateX(420px); opacity: 0; }\n        to { transform: translateX(0); opacity: 1; }\n      }\n      @keyframes contextfort-slide-out {\n        from { transform: translateX(0); opacity: 1; }\n        to { transform: translateX(420px); opacity: 0; }\n      }\n    ",document.head.appendChild(o)}var r=document.createElement("div");r.style.cssText="\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 12px;\n  ",r.innerHTML='\n    <span style="font-size: 24px;">üîê</span>\n    <span style="font-size: 16px; font-weight: 600; color: #fff;">Manual Login Required</span>\n  ';var i=document.createElement("div");i.style.cssText="\n    font-size: 14px;\n    color: #aaa;\n    line-height: 1.5;\n    margin-bottom: 16px;\n  ",i.innerHTML='\n    No saved agent session for <strong style="color: #fff;">'.concat(e,'</strong><br><br>\n    Your session has been cleared. Please login, then click "I\'ve Logged In".<br><br>\n    Or click "Restore My Session" to get your cookies back.\n  ');var a=document.createElement("div");a.style.cssText="\n    display: flex;\n    gap: 10px;\n  ";var s=document.createElement("button");s.textContent="I've Logged In",s.style.cssText="\n    flex: 1;\n    padding: 12px 16px;\n    background: #4ADE80;\n    color: #000;\n    border: none;\n    border-radius: 6px;\n    font-size: 14px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.2s;\n  ",s.onmouseover=function(){return s.style.background="#3bc56f"},s.onmouseout=function(){return s.style.background="#4ADE80"},s.onclick=function(){console.log('[SessionIsolation] User clicked "I\'ve Logged In"'),f({type:"LOGIN_BUTTON_CLICKED",domain:e}),n.style.animation="contextfort-slide-out 0.3s ease-out",setTimeout(function(){return n.remove()},300)};var c=document.createElement("button");c.textContent="Restore My Session",c.style.cssText="\n    flex: 1;\n    padding: 12px 16px;\n    background: #333;\n    color: #fff;\n    border: 1px solid #555;\n    border-radius: 6px;\n    font-size: 14px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.2s;\n  ",c.onmouseover=function(){return c.style.background="#444"},c.onmouseout=function(){return c.style.background="#333"},c.onclick=function(){console.log('[SessionIsolation] User clicked "Restore My Session"'),f({type:"RESTORE_BUTTON_CLICKED",domain:e}),n.style.animation="contextfort-slide-out 0.3s ease-out",setTimeout(function(){return n.remove()},300)},a.appendChild(s),a.appendChild(c),n.appendChild(r),n.appendChild(i),n.appendChild(a),document.body.appendChild(n)}(e.domain),r({success:!0}),!0;if("START_AGENT_LISTENING"===e.type)return console.log("[AgentMode] START_AGENT_LISTENING received"),d||(d=!0,document.addEventListener("click",h,!0),document.addEventListener("input",T,!0),document.addEventListener("click",m,!0),document.addEventListener("dblclick",y,!0),document.addEventListener("contextmenu",g,!0),document.addEventListener("input",v,!0)),r({success:!0}),!0;if("STOP_AGENT_LISTENING"===e.type)return console.log("[AgentMode] STOP_AGENT_LISTENING received"),d&&(d=!1,document.removeEventListener("input",v,!0),document.removeEventListener("contextmenu",g,!0),document.removeEventListener("dblclick",y,!0),document.removeEventListener("click",m,!0),document.removeEventListener("input",T,!0),document.removeEventListener("click",h,!0)),r({success:!0}),!0;if("CAPTURE_STORAGE"===e.type){console.log("[SessionIsolation] CAPTURE_STORAGE: Received request");try{var i={localStorage:o({},localStorage),sessionStorage:o({},sessionStorage)};console.log("[SessionIsolation] CAPTURE_STORAGE: Captured ".concat(Object.keys(i.localStorage).length," localStorage keys, ").concat(Object.keys(i.sessionStorage).length," sessionStorage keys")),console.log("[SessionIsolation] CAPTURE_STORAGE: localStorage keys: ".concat(Object.keys(i.localStorage).join(", ")||"none")),console.log("[SessionIsolation] CAPTURE_STORAGE: sessionStorage keys: ".concat(Object.keys(i.sessionStorage).join(", ")||"none")),r(i)}catch(e){console.error("[SessionIsolation] CAPTURE_STORAGE: Failed:",e),r({localStorage:{},sessionStorage:{}})}return!0}if("CLEAR_STORAGE"===e.type){console.log("[SessionIsolation] CLEAR_STORAGE: Received request"),console.log("[SessionIsolation] CLEAR_STORAGE: Before clear - localStorage: ".concat(localStorage.length," items, sessionStorage: ").concat(sessionStorage.length," items"));try{localStorage.clear(),sessionStorage.clear(),console.log("[SessionIsolation] CLEAR_STORAGE: Successfully cleared both storages"),r({success:!0})}catch(e){console.error("[SessionIsolation] CLEAR_STORAGE: Failed:",e),r({success:!1,error:e.message})}return!0}if("RESTORE_STORAGE"===e.type){var a,s;console.log("[SessionIsolation] RESTORE_STORAGE: Received request");var c=null!==(a=e.data)&&void 0!==a&&a.localStorage?Object.keys(e.data.localStorage).length:0,l=null!==(s=e.data)&&void 0!==s&&s.sessionStorage?Object.keys(e.data.sessionStorage).length:0;console.log("[SessionIsolation] RESTORE_STORAGE: Will restore ".concat(c," localStorage keys, ").concat(l," sessionStorage keys"));try{localStorage.clear(),sessionStorage.clear(),console.log("[SessionIsolation] RESTORE_STORAGE: Cleared existing storage");var u=0;if(e.data&&e.data.localStorage)for(var p=0,S=Object.entries(e.data.localStorage);p<S.length;p++){var b=t(S[p],2),x=b[0],E=b[1];try{localStorage.setItem(x,E),u++}catch(e){console.error("[SessionIsolation] RESTORE_STORAGE: Failed to restore localStorage key:",x,e)}}console.log("[SessionIsolation] RESTORE_STORAGE: Restored ".concat(u," localStorage keys"));var O=0;if(e.data&&e.data.sessionStorage)for(var R=0,I=Object.entries(e.data.sessionStorage);R<I.length;R++){var w=t(I[R],2),k=w[0],A=w[1];try{sessionStorage.setItem(k,A),O++}catch(e){console.error("[SessionIsolation] RESTORE_STORAGE: Failed to restore sessionStorage key:",k,e)}}console.log("[SessionIsolation] RESTORE_STORAGE: Restored ".concat(O," sessionStorage keys")),console.log("[SessionIsolation] RESTORE_STORAGE: Complete"),r({success:!0})}catch(e){console.error("[SessionIsolation] RESTORE_STORAGE: Failed:",e),r({success:!1,error:e.message})}return!0}}})})();