/*! For license information please see content.js.LICENSE.txt */
(()=>{function e(e,n){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,n){if(e){if("string"==typeof e)return t(e,n);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){o&&(e=o);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,l=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return a=e.done,e},e:function(e){l=!0,c=e},f:function(){try{a||null==o.return||o.return()}finally{if(l)throw c}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function n(){var e,t,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",c=r.toStringTag||"@@toStringTag";function a(n,r,i,c){var a=r&&r.prototype instanceof u?r:u,d=Object.create(a.prototype);return o(d,"_invoke",function(n,o,r){var i,c,a,u=0,d=r||[],f=!1,s={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return i=t,c=0,a=e,s.n=n,l}};function m(n,o){for(c=n,a=o,t=0;!f&&u&&!r&&t<d.length;t++){var r,i=d[t],m=s.p,v=i[2];n>3?(r=v===o)&&(a=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=m&&((r=n<2&&m<i[1])?(c=0,s.v=o,s.n=i[1]):m<v&&(r=n<3||i[0]>o||o>v)&&(i[4]=n,i[5]=o,s.n=v,c=0))}if(r||n>1)return l;throw f=!0,o}return function(r,d,v){if(u>1)throw TypeError("Generator is already running");for(f&&1===d&&m(d,v),c=d,a=v;(t=c<2?e:a)||!f;){i||(c?c<3?(c>1&&(s.n=-1),m(c,a)):s.n=a:s.v=a);try{if(u=2,i){if(c||(r="next"),t=i[r]){if(!(t=t.call(i,a)))throw TypeError("iterator result is not an object");if(!t.done)return t;a=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(a=TypeError("The iterator does not provide a '"+r+"' method"),c=1);i=e}else if((t=(f=s.n<0)?a:n.call(o,s))!==l)break}catch(t){i=e,c=1,a=t}finally{u=1}}return{value:t,done:f}}}(n,i,c),!0),d}var l={};function u(){}function d(){}function f(){}t=Object.getPrototypeOf;var s=[][i]?t(t([][i]())):(o(t={},i,function(){return this}),t),m=f.prototype=u.prototype=Object.create(s);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,c,"GeneratorFunction")),e.prototype=Object.create(m),e}return d.prototype=f,o(m,"constructor",f),o(f,"constructor",d),d.displayName="GeneratorFunction",o(f,c,"GeneratorFunction"),o(m),o(m,c,"Generator"),o(m,i,function(){return this}),o(m,"toString",function(){return"[object Generator]"}),(n=function(){return{w:a,m:v}})()}function o(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}o=function(e,t,n,r){function c(t,n){o(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(c("next",0),c("throw",1),c("return",2))},o(e,t,n,r)}function r(e,t,n,o,r,i,c){try{var a=e[i](c),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(o,r)}function i(e){try{var t;"undefined"!=typeof chrome&&null!==(t=chrome)&&void 0!==t&&null!==(t=t.runtime)&&void 0!==t&&t.sendMessage?chrome.runtime.sendMessage(e):console.log("[ContextFort] Error sending message: chrome.runtime.sendMessage is unavailable")}catch(e){console.log("[ContextFort] Error sending message:",e)}}var c,a=!1,l=!1,u=!1,d=[];function f(e){var t;return e?{tag:e.tagName,id:e.id||null,className:e.className||null,text:(null===(t=e.textContent)||void 0===t?void 0:t.substring(0,50))||null,type:e.type||null,name:e.name||null}:null}function s(e){a&&i({type:"SCREENSHOT_TRIGGER",action:"click",eventType:"click",element:f(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title})}function m(e){a&&i({type:"SCREENSHOT_TRIGGER",action:"dblclick",eventType:"click",element:f(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title})}function v(e){a&&i({type:"SCREENSHOT_TRIGGER",action:"rightclick",eventType:"click",element:f(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title})}function y(e){a&&i({type:"SCREENSHOT_TRIGGER",action:e.type,eventType:"input",element:f(e.target),inputValue:e.target.value||null,url:window.location.href,title:document.title})}function p(){a||(a=!0,document.addEventListener("click",b,!0),document.addEventListener("input",w,!0),document.addEventListener("click",s,!0),document.addEventListener("dblclick",m,!0),document.addEventListener("contextmenu",v,!0),document.addEventListener("input",y,!0))}function g(){a&&(a=!1,document.removeEventListener("input",y,!0),document.removeEventListener("contextmenu",v,!0),document.removeEventListener("dblclick",m,!0),document.removeEventListener("click",s,!0),document.removeEventListener("input",w,!0),document.removeEventListener("click",b,!0))}function E(e,t){var n,o=e.tagName,r=e.id||null,i=e.className||null,c=(null===(n=e.textContent)||void 0===n?void 0:n.trim())||null,a=e.type||null,l=e.name||null;return t.elementTag===o&&t.elementId===r&&t.elementClass===i&&(null===t.elementText||t.elementText===c)&&t.elementType===a&&t.elementName===l}function h(e){var t=e.style.border;e.style.border="2px solid red",setTimeout(function(){e.style.border=t},500)}function b(t){if(function(t){for(var n=window.location.href,o=document.title,r=t;r&&r!==document.body;){var i,c=e(d);try{for(c.s();!(i=c.n()).done;){var a=i.value;if("click"===a.actionType&&(!a.url||a.url===n)&&(!a.title||a.title===o)&&E(r,a))return!0}}catch(e){c.e(e)}finally{c.f()}r=r.parentElement}return!1}(t.target))return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),h(t.target),!1}function w(t){if(function(t){for(var n=window.location.href,o=document.title,r=t;r&&r!==document.body;){var i,c=e(d);try{for(c.s();!(i=c.n()).done;){var a=i.value;if(("input"===a.actionType||"change"===a.actionType)&&(!a.url||a.url===n)&&(!a.title||a.title===o)&&E(r,a))return!0}}catch(e){c.e(e)}finally{c.f()}r=r.parentElement}return!1}(t.target))return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),h(t.target),!1}window.scrollY,(c=n().m(function e(){var t;return n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,chrome.storage.local.get(["blockedActions"]);case 1:(t=e.v).blockedActions&&(d=t.blockedActions);case 2:return e.a(2)}},e)}),function(){var e=this,t=arguments;return new Promise(function(n,o){var i=c.apply(e,t);function a(e){r(i,n,o,a,l,"next",e)}function l(e){r(i,n,o,a,l,"throw",e)}a(void 0)})})(),chrome.storage.onChanged.addListener(function(e,t){"local"===t&&e.blockedActions&&(d=e.blockedActions.newValue||[])}),new MutationObserver(function(t){var n,o=e(t);try{for(o.s();!(n=o.n()).done;){var r,c=n.value,d=e(c.addedNodes);try{for(d.s();!(r=d.n()).done;){var f=r.value;f.nodeType===Node.ELEMENT_NODE&&("claude-agent-glow-border"!==f.id&&"claude-agent-stop-button"!==f.id||l||a||(l=!0,setTimeout(function(){l=!1},100),i({type:"AGENT_DETECTED",url:window.location.href}),p()))}}catch(e){d.e(e)}finally{d.f()}var s,m=e(c.removedNodes);try{for(m.s();!(s=m.n()).done;){var v=s.value;v.nodeType===Node.ELEMENT_NODE&&("claude-agent-glow-border"!==v.id&&"claude-agent-stop-button"!==v.id||u||!a||document.hidden||(u=!0,setTimeout(function(){u=!1},100),i({type:"AGENT_STOPPED"}),g()))}}catch(e){m.e(e)}finally{m.f()}}}catch(e){o.e(e)}finally{o.f()}}).observe(document.documentElement,{childList:!0,subtree:!0}),document.getElementById("claude-agent-glow-border")&&(i({type:"AGENT_DETECTED",source:"existing"}),p()),document.addEventListener("visibilitychange",function(){!document.hidden&&a&&setTimeout(function(){!document.getElementById("claude-agent-glow-border")&&a&&(i({type:"AGENT_STOPPED"}),g())},500)})})();