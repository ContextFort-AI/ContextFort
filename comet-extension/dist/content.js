/*! For license information please see content.js.LICENSE.txt */
(()=>{function e(){var n,o,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function l(e,r,i,a){var l=r&&r.prototype instanceof d?r:d,s=Object.create(l.prototype);return t(s,"_invoke",function(e,t,r){var i,a,l,d=0,s=r||[],u=!1,m={p:0,n:0,v:n,a:f,f:f.bind(n,4),d:function(e,t){return i=e,a=0,l=n,m.n=t,c}};function f(e,t){for(a=e,l=t,o=0;!u&&d&&!r&&o<s.length;o++){var r,i=s[o],f=m.p,p=i[2];e>3?(r=p===t)&&(l=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=n):i[0]<=f&&((r=e<2&&f<i[1])?(a=0,m.v=t,m.n=i[1]):f<p&&(r=e<3||i[0]>t||t>p)&&(i[4]=e,i[5]=t,m.n=p,a=0))}if(r||e>1)return c;throw u=!0,t}return function(r,s,p){if(d>1)throw TypeError("Generator is already running");for(u&&1===s&&f(s,p),a=s,l=p;(o=a<2?n:l)||!u;){i||(a?a<3?(a>1&&(m.n=-1),f(a,l)):m.n=l:m.v=l);try{if(d=2,i){if(a||(r="next"),o=i[r]){if(!(o=o.call(i,l)))throw TypeError("iterator result is not an object");if(!o.done)return o;l=o.value,a<2&&(a=0)}else 1===a&&(o=i.return)&&o.call(i),a<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),a=1);i=n}else if((o=(u=m.n<0)?l:e.call(t,m))!==c)break}catch(e){i=n,a=1,l=e}finally{d=1}}return{value:o,done:u}}}(e,i,a),!0),s}var c={};function d(){}function s(){}function u(){}o=Object.getPrototypeOf;var m=[][i]?o(o([][i]())):(t(o={},i,function(){return this}),o),f=u.prototype=d.prototype=Object.create(m);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,t(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=u,t(f,"constructor",u),t(u,"constructor",s),s.displayName="GeneratorFunction",t(u,a,"GeneratorFunction"),t(f),t(f,a,"Generator"),t(f,i,function(){return this}),t(f,"toString",function(){return"[object Generator]"}),(e=function(){return{w:l,m:p}})()}function t(e,n,o,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}t=function(e,n,o,r){function a(n,o){t(e,n,function(e){return this._invoke(n,o,e)})}n?i?i(e,n,{value:o,enumerable:!r,configurable:!r,writable:!r}):e[n]=o:(a("next",0),a("throw",1),a("return",2))},t(e,n,o,r)}function n(e,t,n,o,r,i,a){try{var l=e[i](a),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(o,r)}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,a=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw a}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var i=!1;function a(e){try{var t;"undefined"!=typeof chrome&&null!==(t=chrome)&&void 0!==t&&null!==(t=t.runtime)&&void 0!==t&&t.sendMessage?(console.log("[ContextFort for Comet] Sending message:",e.type,e),chrome.runtime.sendMessage(e)):console.error("[ContextFort for Comet] chrome.runtime.sendMessage is not available")}catch(e){console.error("[ContextFort for Comet] Error sending message to background script:",e)}}function l(e){var t;if(!e)return null;var n=null;return e.className&&("string"==typeof e.className?n=e.className:void 0!==e.className.baseVal&&(n=e.className.baseVal)),{tag:e.tagName,id:e.id||null,className:n,text:(null===(t=e.textContent)||void 0===t?void 0:t.substring(0,50))||null,type:e.type||null,name:e.name||null}}function c(e){i&&(console.log("[ContextFort for Comet] üñ±Ô∏è CLICK captured:",{target:e.target.tagName,id:e.target.id,class:e.target.className,x:e.clientX,y:e.clientY}),a({type:"SCREENSHOT_TRIGGER",action:"click",eventType:"click",element:l(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title}))}function d(e){i&&(console.log("[ContextFort for Comet] üñ±Ô∏èüñ±Ô∏è DOUBLE-CLICK captured:",{target:e.target.tagName,id:e.target.id}),a({type:"SCREENSHOT_TRIGGER",action:"dblclick",eventType:"click",element:l(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title}))}function s(e){i&&(console.log("[ContextFort for Comet] üñ±Ô∏è RIGHT-CLICK captured:",{target:e.target.tagName,id:e.target.id}),a({type:"SCREENSHOT_TRIGGER",action:"rightclick",eventType:"click",element:l(e.target),coordinates:{x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio},url:window.location.href,title:document.title}))}function u(e){var t;i&&(console.log("[ContextFort for Comet] ‚å®Ô∏è INPUT captured:",{target:e.target.tagName,id:e.target.id,type:e.target.type,valueLength:(null===(t=e.target.value)||void 0===t?void 0:t.length)||0}),a({type:"SCREENSHOT_TRIGGER",action:e.type,eventType:"input",element:l(e.target),inputValue:e.target.value||null,url:window.location.href,title:document.title}))}function m(){i?console.log("[ContextFort for Comet] ‚ö†Ô∏è startListening called but already active"):(console.log("[ContextFort for Comet] üéß START LISTENING - Adding event listeners"),i=!0,document.addEventListener("click",h,!0),document.addEventListener("input",T,!0),document.addEventListener("click",c,!0),document.addEventListener("dblclick",d,!0),document.addEventListener("contextmenu",s,!0),document.addEventListener("input",u,!0))}function f(){i?(console.log("[ContextFort for Comet] üõë STOP LISTENING - Removing event listeners"),i=!1,document.removeEventListener("input",u,!0),document.removeEventListener("contextmenu",s,!0),document.removeEventListener("dblclick",d,!0),document.removeEventListener("click",c,!0),document.removeEventListener("input",T,!0),document.removeEventListener("click",h,!0)):console.log("[ContextFort for Comet] ‚ö†Ô∏è stopListening called but not active")}console.log("[ContextFort for Comet] Content script loaded on:",window.location.href);var p=!1,g=!1,v=new MutationObserver(function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var r,l=t.value,c=o(l.addedNodes);try{for(c.s();!(r=c.n()).done;){var d=r.value;d.nodeType===Node.ELEMENT_NODE&&(d.id&&d.id.includes("pplx")&&console.log("[ContextFort for Comet] üîç DOM ADDED - pplx element:",d.id),"pplx-agent-0_0-overlay"!==d.id&&"pplx-agent-0_0-overlay-stop-button"!==d.id||(console.log("[ContextFort for Comet] üü¢ AGENT OVERLAY DETECTED:",d.id),g||i?console.log("[ContextFort for Comet] ‚ö†Ô∏è Skipping detection - pending:",g,"active:",i):(g=!0,setTimeout(function(){g=!1},100),console.log("[ContextFort for Comet] üì§ Sending AGENT_DETECTED message"),a({type:"AGENT_DETECTED",url:window.location.href}),m())))}}catch(e){c.e(e)}finally{c.f()}var s,u=o(l.removedNodes);try{for(u.s();!(s=u.n()).done;){var v=s.value;v.nodeType===Node.ELEMENT_NODE&&(v.id&&v.id.includes("pplx")&&console.log("[ContextFort for Comet] üîç DOM REMOVED - pplx element:",v.id),"pplx-agent-0_0-overlay"!==v.id&&"pplx-agent-0_0-overlay-stop-button"!==v.id||(console.log("[ContextFort for Comet] üî¥ AGENT OVERLAY REMOVED:",v.id),p||!i||document.hidden?console.log("[ContextFort for Comet] ‚ö†Ô∏è Skipping stop - pending:",p,"active:",i,"hidden:",document.hidden):(p=!0,setTimeout(function(){p=!1},100),console.log("[ContextFort for Comet] üì§ Sending AGENT_STOPPED message"),a({type:"AGENT_STOPPED"}),f())))}}catch(e){u.e(e)}finally{u.f()}}}catch(e){n.e(e)}finally{n.f()}});console.log("[ContextFort for Comet] üëÅÔ∏è Starting MutationObserver"),v.observe(document.documentElement,{childList:!0,subtree:!0}),document.getElementById("pplx-agent-0_0-overlay")?(console.log("[ContextFort for Comet] üü¢ EXISTING OVERLAY FOUND on page load"),a({type:"AGENT_DETECTED",source:"existing"}),m()):console.log("[ContextFort for Comet] No existing overlay found on page load"),document.addEventListener("visibilitychange",function(){console.log("[ContextFort for Comet] üëÅÔ∏è Visibility changed - hidden:",document.hidden,"agentActive:",i),!document.hidden&&i&&setTimeout(function(){var e=document.getElementById("pplx-agent-0_0-overlay");console.log("[ContextFort for Comet] Checking overlay after visibility change - found:",!!e),!e&&i&&(console.log("[ContextFort for Comet] üî¥ Overlay gone after tab became visible - stopping agent"),a({type:"AGENT_STOPPED"}),f())},500)});var y,x=[];function C(e,t){var n,o=e.tagName,r=e.id||null,i=e.className||null,a=(null===(n=e.textContent)||void 0===n?void 0:n.trim())||null,l=e.type||null,c=e.name||null;return t.elementTag===o&&t.elementId===r&&t.elementClass===i&&(null===t.elementText||t.elementText===a)&&t.elementType===l&&t.elementName===c}function E(e){var t=e.style.border;e.style.border="2px solid red",setTimeout(function(){e.style.border=t},500)}function h(e){if(function(e){for(var t=window.location.href,n=document.title,r=e;r&&r!==document.body;){var i,a=o(x);try{for(a.s();!(i=a.n()).done;){var l=i.value;if("click"===l.actionType&&(!l.url||l.url===t)&&(!l.title||l.title===n)&&C(r,l))return console.log("[ContextFort for Comet] üö´ CLICK BLOCKED on element:",r.tagName,r.id),!0}}catch(e){a.e(e)}finally{a.f()}r=r.parentElement}return!1}(e.target))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),E(e.target),console.log("[ContextFort for Comet] üö´ ACTION_BLOCKED sent for click"),a({type:"ACTION_BLOCKED",actionType:"click",url:window.location.href,title:document.title}),!1}function T(e){if(function(e){for(var t=window.location.href,n=document.title,r=e;r&&r!==document.body;){var i,a=o(x);try{for(a.s();!(i=a.n()).done;){var l=i.value;if(("input"===l.actionType||"change"===l.actionType)&&(!l.url||l.url===t)&&(!l.title||l.title===n)&&C(r,l))return console.log("[ContextFort for Comet] üö´ INPUT BLOCKED on element:",r.tagName,r.id),!0}}catch(e){a.e(e)}finally{a.f()}r=r.parentElement}return!1}(e.target))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),E(e.target),console.log("[ContextFort for Comet] üö´ ACTION_BLOCKED sent for input"),a({type:"ACTION_BLOCKED",actionType:"input",url:window.location.href,title:document.title}),!1}(y=e().m(function t(){var n;return e().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,chrome.storage.local.get(["blockedActions"]);case 1:(n=e.v).blockedActions&&(x=n.blockedActions,console.log("[ContextFort for Comet] üìã Loaded blocked actions:",x.length));case 2:return e.a(2)}},t)}),function(){var e=this,t=arguments;return new Promise(function(o,r){var i=y.apply(e,t);function a(e){n(i,o,r,a,l,"next",e)}function l(e){n(i,o,r,a,l,"throw",e)}a(void 0)})})(),chrome.storage.onChanged.addListener(function(e,t){"local"===t&&e.blockedActions&&(x=e.blockedActions.newValue||[],console.log("[ContextFort for Comet] üìã Blocked actions updated:",x.length))}),chrome.runtime.onMessage.addListener(function(e,t,n){console.log("[ContextFort for Comet] üì® Received message:",e.type,e),"START_LISTENING"===e.type?(console.log("[ContextFort for Comet] üéß START_LISTENING received from background"),m()):"STOP_LISTENING"===e.type?(console.log("[ContextFort for Comet] üõë STOP_LISTENING received from background"),f()):"SHOW_NOTIFICATION"===e.type&&function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error";console.log("[ContextFort for Comet] Showing notification:",e,t,n);var o=document.getElementById("contextfort-comet-notification");o&&o.remove();var r=document.createElement("div");if(r.id="contextfort-comet-notification",r.style.cssText='\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    min-width: 320px;\n    max-width: 400px;\n    background: white;\n    border-radius: 8px;\n    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2), 0 2px 8px rgba(0, 0, 0, 0.1);\n    z-index: 2147483647;\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n    display: flex;\n    align-items: flex-start;\n    padding: 16px;\n    gap: 12px;\n    animation: contextfort-comet-slide-in 0.3s ease-out;\n    border-left: 4px solid '.concat("error"===n?"#DC2626":"#2563EB",";\n  "),!document.getElementById("contextfort-comet-notification-styles")){var i=document.createElement("style");i.id="contextfort-comet-notification-styles",i.textContent="\n      @keyframes contextfort-comet-slide-in {\n        from {\n          transform: translateX(420px);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n      @keyframes contextfort-comet-slide-out {\n        from {\n          transform: translateX(0);\n          opacity: 1;\n        }\n        to {\n          transform: translateX(420px);\n          opacity: 0;\n        }\n      }\n    ",document.head.appendChild(i)}var a=document.createElement("div");a.style.cssText="\n    flex-shrink: 0;\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    line-height: 24px;\n  ",a.textContent="error"===n?"‚õî":"‚ÑπÔ∏è";var l=document.createElement("div");l.style.cssText="\n    flex: 1;\n    min-width: 0;\n  ";var c=document.createElement("div");c.style.cssText="\n    font-weight: 600;\n    font-size: 14px;\n    color: #1F2937;\n    margin-bottom: 4px;\n  ",c.textContent=e;var d=document.createElement("div");d.style.cssText="\n    font-size: 13px;\n    color: #6B7280;\n    line-height: 1.4;\n  ",d.textContent=t,l.appendChild(c),l.appendChild(d);var s=document.createElement("button");s.style.cssText="\n    flex-shrink: 0;\n    width: 20px;\n    height: 20px;\n    border: none;\n    background: transparent;\n    color: #9CA3AF;\n    cursor: pointer;\n    font-size: 18px;\n    line-height: 1;\n    padding: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  ",s.textContent="√ó",s.onclick=function(){r.style.animation="contextfort-comet-slide-out 0.3s ease-out",setTimeout(function(){return r.remove()},300)},r.appendChild(a),r.appendChild(l),r.appendChild(s),document.body.appendChild(r),setTimeout(function(){r.parentElement&&(r.style.animation="contextfort-comet-slide-out 0.3s ease-out",setTimeout(function(){return r.remove()},300))},5e3)}(e.title,e.message,e.notificationType)})})();